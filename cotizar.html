<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cotización</title>
  <link rel="stylesheet" href="estilos/cotizar.css">
</head>
<body>

<div class="container">
  <header>
    <nav class="menu">
      <ul id="menu-lista">
        <li><img src="img/logo.png" alt="Logo" class="logo"></li>
        <li><a href="index.html">Inicio</a></li>
        <li><a href="cotizar.html" class="active">Cotizar</a></li>
        <li><a href="agenda.html">Agenda</a></li>
        <li><a href="inventario.html">Inventario</a></li>
        <li><a href="colaboradores.html">Colaboradores</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <h1>Cotización</h1>
    <div class="contenedor">
      <form id="cotizarForm">
        <!-- Datos del Cliente -->
        <button type="button" class="accordion">Datos del Cliente</button>
        <div class="panel">
          <label for="nombreCliente">Nombre del Cliente:</label>
          <input type="text" id="nombreCliente" placeholder="Escriba el nombre">

          <label for="numeroCliente">Número celular del Cliente:</label>
          <input type="text" id="numeroCliente" placeholder="Escriba el número">

          <label for="fechaServicio">Fecha requerida para el servicio:</label>
          <input type="date" id="fechaServicio" required>
        </div>

        <!-- Detalles del Trabajo -->
        <button type="button" class="accordion">Detalles del Trabajo</button>
        <div class="panel">
          <label for="tiposTrabajos">Tipo de Trabajo:</label>
          <select id="tiposTrabajos">
            <option value="Acarreo">Acarreo</option>
            <option value="Wincheo">Wincheo</option>
            <option value="Mudanza Internas">Mudanza Internas</option>
          </select>

          <label>Colaboradores Recomendados:</label>
          <div id="colaboradores-lista"></div>

          <label for="ubiPartida">Punto de partida:</label>
          <input type="text" id="ubiPartida">

          <label for="ubiLlegada">Punto de llegada:</label>
          <input type="text" id="ubiLlegada">

          <label for="descripcion">Descripción del Trabajo:</label>
          <textarea id="descripcion" placeholder="Escriba la descripción del servicio" rows="5" style="resize: none;" required></textarea>
        </div>

        <!-- Servicios Adicionales -->
        <button type="button" class="accordion">Servicios</button>
        <div class="panel panel-servicios">
          <label for="montaCarga">
            <input type="checkbox" id="montaCarga">
            <span>Monta Carga</span>
            <span class="precio">$100</span>
          </label>

          <label for="material">
            <input type="checkbox" id="material">
            <span>Sogas y cintas adhesivas</span>
            <span class="precio">$30</span>
          </label>

          <label for="materialEmbalaje">
            <input type="checkbox" id="materialEmbalaje">
            <span>Material de embalaje</span>
            <span class="precio">$25</span>
          </label>

          <label for="camionPequeño">
            <input type="checkbox" id="camionPequeño">
            <span>Camión Pequeño</span>
            <span class="precio">$90</span>
          </label>

          <label for="camionGrande">
            <input type="checkbox" id="camionGrande">
            <span>Camión Grande</span>
            <span class="precio">$150</span>
          </label>

          <label for="camionPlancha">
            <input type="checkbox" id="camionPlancha">
            <span>Camión de Plancha</span>
            <span class="precio">$200</span>
          </label>
        </div>

        

        <input type="button" value="Guardar" onclick="guardarSolicitud()">
      </form>
    </div>
  </main>
</div>

<!-- Modal de Cotización -->
<div id="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:1000;">
  <div style="background:white; padding:20px; border-radius:8px; max-width:600px; width:90%;">
    <h2>Información de la Cotización</h2>
    <div id="modal-content"></div>
    <button onclick="cerrarModal()">Cerrar</button>
  </div>
</div>

<!-- SCRIPT -->
<script>
// PROTECCIÓN: Si es admin, no puede entrar
const userType = localStorage.getItem('usuario');
if (userType === 'admin') {
  alert('No tienes permiso para ver esta página.');
  window.location.href = 'index.html';
}

// Acordeón
const acc = document.getElementsByClassName("accordion");
for (let i = 0; i < acc.length; i++) {
  acc[i].addEventListener("click", function() {
    this.classList.toggle("active");
    const panel = this.nextElementSibling;
    if (panel.style.display === "block") {
      panel.style.display = "none";
    } else {
      panel.style.display = "block";
    }
  });
}

// Colaboradores
const colaboradoresPorTrabajo = {
  "Acarreo": [
    { nombre: "Juan Pérez - Conductor", pago: 10 },
    { nombre: "Sebastian Rodríguez - Ayudante", pago: 8 },
    { nombre: "Paul Jaén - Ayudante", pago: 8 }
  ],
  "Wincheo": [
    { nombre: "Manuel Arauz - Manejador", pago: 12 },
    { nombre: "Sebastian Rodríguez - Ayudante", pago: 8 },
    { nombre: "Camilo Ortega - Conductor", pago: 10 },
    { nombre: "Federico Jaén - Manejador", pago: 12 }
  ],
  "Mudanza Internas": [
    { nombre: "Sebastian Rodríguez - Ayudante", pago: 8 },
    { nombre: "Juan Pérez - Conductor", pago: 10 },
    { nombre: "Andrés Lomon - Cargador", pago: 9 }
  ]
};


function mostrarColaboradores() {
  const tipoTrabajo = document.getElementById("tiposTrabajos").value;
  const colaboradoresLista = document.getElementById("colaboradores-lista");
  const colaboradores = colaboradoresPorTrabajo[tipoTrabajo] || [];
  colaboradoresLista.innerHTML = `
    <ul>
      ${colaboradores.map(c => `<li>${c.nombre} - <strong>$${c.pago}/h</strong></li>`).join("")}
    </ul>
  `;
}

document.getElementById("tiposTrabajos").addEventListener("change", mostrarColaboradores);
mostrarColaboradores();

// Precios de servicios
const servicioValores = {
  "montaCarga": 100,
  "material": 30,
  "materialEmbalaje": 25,
  "camionPequeño": 90,
  "camionGrande": 150,
  "camionPlancha": 200
};

const costoManoObra = {
  "Acarreo": 100,
  "Wincheo": 160,
  "Mudanza Internas": 130
};

const costoAdicionalTrabajo = {
  "Acarreo": 200,
  "Wincheo": 1000,
  "Mudanza Internas": 500
};

// Guardar solicitud
function guardarSolicitud() {
  const cliente = document.getElementById("nombreCliente").value;
  const numero = document.getElementById("numeroCliente").value;
  const fechaServicio = document.getElementById("fechaServicio").value;
  const tipoTrabajo = document.getElementById("tiposTrabajos").value;
  const ubiPartida = document.getElementById("ubiPartida").value;
  const ubiLlegada = document.getElementById("ubiLlegada").value;
  const descripcion = document.getElementById("descripcion").value;

  const { total: totalServicios, serviciosDetalle } = calcularTotalServicios();
  const costoMano = costoManoObra[tipoTrabajo] || 0;
  const adicional = costoAdicionalTrabajo[tipoTrabajo] || 0;
  const sumaFinal = totalServicios + costoMano + adicional;

  // Mostrar en modal
  let contenido = `
    <p><strong>Nombre:</strong> ${cliente}</p>
    <p><strong>Contacto:</strong> ${numero}</p>
    <p><strong>Fecha del Servicio:</strong> ${fechaServicio}</p>
    <p><strong>Tipo de Trabajo:</strong> ${tipoTrabajo}</p>
    <h4>Servicios Adicionales:</h4>
    <ul>${serviciosDetalle.map(servicio => `<li>${servicio.nombre}: $${servicio.valor}</li>`).join("")}</ul>
    <p><strong>Total Servicios:</strong> $${totalServicios}</p>
    <p><strong>Costo Mano de Obra:</strong> $${costoMano}</p>
    <p><strong>Costo Adicional:</strong> $${adicional}</p>
    <p><strong>Suma Final:</strong> $${sumaFinal}</p>
    <p><strong>Punto de partida:</strong> ${ubiPartida}</p>
    <p><strong>Punto de llegada:</strong> ${ubiLlegada}</p>
    <p><strong>Descripción:</strong> ${descripcion}</p>
  `;
  document.getElementById("modal-content").innerHTML = contenido;
  document.getElementById("modal").style.display = "flex";

  document.getElementById("cotizarForm").reset();
}

function calcularTotalServicios() {
  let total = 0;
  const serviciosDetalle = [];
  Object.keys(servicioValores).forEach(id => {
    const checkbox = document.getElementById(id);
    if (checkbox && checkbox.checked) {
      const valor = servicioValores[id];
      total += valor;
      const label = document.querySelector(`label[for="${id}"]`) || { textContent: id };
      serviciosDetalle.push({
        nombre: label.textContent.trim(),
        valor: valor
      });
    }
  });
  return { total, serviciosDetalle };
}

function cerrarModal() {
  document.getElementById("modal").style.display = "none";
}

// Menu dinámico
const menu = document.getElementById('menu-lista');
if (menu) {
  menu.innerHTML = '<li><img src="img/logo.png" alt="Logo" class="logo"></li>';
  if (userType === 'admin') {
    menu.innerHTML += `
      <li><a href="solicitudes.html">Solicitudes</a></li>
      <li><a href="agenda.html">Agenda</a></li>
      <li><a href="inventario.html">Inventario</a></li>
      <li><a href="colaboradores.html">Colaboradores</a></li>
      <li><a href="#" id="logout">Cerrar sesión</a></li>
    `;
  } else if (userType === 'cliente') {
    menu.innerHTML += `
      <li><a href="cotizar.html" class="active">Cotizar</a></li>
      <li><a href="#" id="logout">Cerrar sesión</a></li>
    `;
  } else {
    menu.innerHTML += `
      <li><a href="index.html">Inicio</a></li>
      <li><a href="login.html">Iniciar sesión</a></li>
    `;
  }
}
const logout = document.getElementById('logout');
if (logout) {
  logout.addEventListener('click', function() {
    localStorage.removeItem('usuario');
    window.location.href = 'login.html';
  });
}
</script>

</body>
</html>
